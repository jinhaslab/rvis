---
title: "ggplot2 ì™„ë²½ ë§ˆìŠ¤í„°í•˜ê¸°"
author: "ì—°ì„¸ëŒ€ ì‚°ì—…ë³´ê±´ ì—°êµ¬ì†Œ"
date: today
---

```{r setup, include=FALSE}
# í•œê¸€ í°íŠ¸ ì„¤ì •
library(showtext)
library(sysfonts)
font_add_google("Noto Sans KR", "noto")
showtext_auto()

library(ggplot2)
theme_set(theme_grey(base_family = "noto"))
showtext_opts(dpi = 96)

knitr::opts_chunk$set(
  fig.showtext = TRUE,
  dev = "png",
  dpi = 96
)
```

# ggplot2 ì™„ë²½ ë§ˆìŠ¤í„°í•˜ê¸°

::: {.callout-note}
## ğŸ¯ í•™ìŠµ ëª©í‘œ

ì´ ì±•í„°ë¥¼ ë§ˆì¹˜ë©´ ë‹¤ìŒì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

- ê·¸ë˜í”½ ë¬¸ë²•(Grammar of Graphics)ì˜ **7ê°€ì§€ êµ¬ì„± ìš”ì†Œ** ì™„ë²½ ì´í•´
- `aes()` í•¨ìˆ˜ë¡œ ë³€ìˆ˜ë¥¼ ì‹œê°ì  ì†ì„±ì— ë§¤í•‘
- 20ê°œ ì´ìƒì˜ `geom_*()` í•¨ìˆ˜ í™œìš©
- `facet_wrap()`ê³¼ `facet_grid()`ë¡œ ë‹¤ì°¨ì› ì‹œê°í™”
- `scale_*()` í•¨ìˆ˜ë¡œ ì¶•ê³¼ ìƒ‰ìƒ ì¡°ì •
- ë³´ê±´í•™ ë°ì´í„°ì— ì í•©í•œ ê·¸ë˜í”„ ìœ í˜• ì„ íƒ
:::

::: {.callout-tip}
## ğŸ“š ì´ ì±•í„°ì˜ ì‹¤ìŠµ ë°ì´í„°

```r
library(tidyverse)
library(here)

# ê±´ê°•ê²€ì§„ ë°ì´í„° (N=1,000)
health <- read_csv(here("data", "processed", "health_survey.csv"))

# ì§ˆë³‘ ë°œìƒë¥  ë°ì´í„°
disease <- read_csv(here("data", "processed", "disease_incidence.csv"))
```

ë°ì´í„°ê°€ ì—†ë‹¤ë©´ [Chapter 1 Section 1.2.6](01-introduction.html#ì‹¤ìŠµ-ë°ì´í„°-ìƒì„±-1-2ë¶„)ì„ ì°¸ê³ í•˜ì„¸ìš”.
:::

## 2.1 ê·¸ë˜í”½ ë¬¸ë²•ì˜ 7ê°€ì§€ êµ¬ì„± ìš”ì†Œ

Chapter 1ì—ì„œ ê°„ëµíˆ ì†Œê°œí•œ **Grammar of Graphics**ë¥¼ ì´ì œ ê¹Šì´ ìˆê²Œ ë°°ì›ë‹ˆë‹¤. Leland Wilkinsonì˜ ì´ë¡ ì„ Hadley Wickhamì´ ggplot2ë¡œ êµ¬í˜„í•œ ì´ ì²´ê³„ëŠ” ëª¨ë“  ê·¸ë˜í”„ë¥¼ 7ê°€ì§€ êµ¬ì„± ìš”ì†Œì˜ ì¡°í•©ìœ¼ë¡œ ì´í•´í•©ë‹ˆë‹¤.

### 2.1.1 ë°ì´í„° (Data)

**ì •ì˜**: ì‹œê°í™”í•  ë°ì´í„°í”„ë ˆì„ ë˜ëŠ” tibble

ggplot2ëŠ” **tidy data** í˜•ì‹ì„ ì„ í˜¸í•©ë‹ˆë‹¤:
- ê° ë³€ìˆ˜ëŠ” ì—´(column)
- ê° ê´€ì¸¡ì¹˜ëŠ” í–‰(row)
- ê° ê°’ì€ ì…€(cell)

**ì˜ˆì œ: ê±´ê°•ê²€ì§„ ë°ì´í„°**

```{r}
#| eval: false
#| echo: true

library(tidyverse)

# Tidy í˜•ì‹ì˜ ë°ì´í„°
health <- tibble(
  id = 1:5,
  age = c(25, 30, 35, 40, 45),
  bmi = c(22.5, 25.3, 28.1, 23.7, 26.4),
  gender = c("F", "M", "M", "F", "F")
)

# ggplotì— ë°ì´í„° ì „ë‹¬
ggplot(data = health)  # ë¹ˆ ìº”ë²„ìŠ¤
```

::: {.callout-note}
## ğŸ’¡ Wide vs. Long í˜•ì‹

ë³´ê±´í•™ ë°ì´í„°ëŠ” ì¢…ì¢… **wide í˜•ì‹**ìœ¼ë¡œ ì œê³µë˜ì§€ë§Œ, ggplot2ëŠ” **long í˜•ì‹**ì„ ì„ í˜¸í•©ë‹ˆë‹¤.

**Wide í˜•ì‹ (ì¸¡ì • ì‹œì ì´ ì—´ë¡œ):**
```
id   baseline_bp   month3_bp   month6_bp
1    120           118         115
2    140           135         130
```

**Long í˜•ì‹ (ggplot2 ì„ í˜¸):**
```
id   time       blood_pressure
1    baseline   120
1    month3     118
1    month6     115
2    baseline   140
2    month3     135
2    month6     130
```

**ë³€í™˜:**
```r
library(tidyr)

# Wide â†’ Long
long_data <- wide_data %>%
  pivot_longer(cols = contains("_bp"),
               names_to = "time",
               values_to = "blood_pressure")

# Long â†’ Wide
wide_data <- long_data %>%
  pivot_wider(names_from = time,
              values_from = blood_pressure)
```
:::

### 2.1.2 ë¯¸í•™ ë§¤í•‘ (Aesthetic Mappings)

**ì •ì˜**: ë°ì´í„°ì˜ ë³€ìˆ˜ë¥¼ ê·¸ë˜í”„ì˜ ì‹œê°ì  ì†ì„±ì— ì—°ê²°

`aes()` í•¨ìˆ˜ëŠ” "ì–´ë–¤ ë³€ìˆ˜ë¥¼ ì–´ë””ì— í‘œí˜„í• ì§€"ë¥¼ ì •ì˜í•©ë‹ˆë‹¤.

**ì£¼ìš” Aesthetics:**

| Aesthetic | ì—­í•  | ì í•©í•œ ë³€ìˆ˜ íƒ€ì… | ì˜ˆì‹œ |
|-----------|------|------------------|------|
| `x`, `y` | ì¶• ìœ„ì¹˜ | ì—°ì†í˜•, ë²”ì£¼í˜• | `aes(x = age, y = bmi)` |
| `color` | ì /ì„  ìƒ‰ìƒ | ë²”ì£¼í˜•, ì—°ì†í˜• | `aes(color = gender)` |
| `fill` | ë©´ ì±„ìš°ê¸° ìƒ‰ìƒ | ë²”ì£¼í˜•, ì—°ì†í˜• | `aes(fill = treatment)` |
| `size` | í¬ê¸° | ì—°ì†í˜• | `aes(size = population)` |
| `shape` | ì  ëª¨ì–‘ | ë²”ì£¼í˜• (ìµœëŒ€ 6ê°œ) | `aes(shape = disease_type)` |
| `alpha` | íˆ¬ëª…ë„ | ì—°ì†í˜• | `aes(alpha = confidence)` |
| `linetype` | ì„  ìœ í˜• | ë²”ì£¼í˜• | `aes(linetype = group)` |

**ì˜ˆì œ 1: ê¸°ë³¸ ë§¤í•‘**

```{r}
#| eval: false
#| echo: true

# xì¶•ì— ë‚˜ì´, yì¶•ì— BMI
ggplot(health, aes(x = age, y = bmi)) +
  geom_point()
```

**ì˜ˆì œ 2: ìƒ‰ìƒìœ¼ë¡œ ê·¸ë£¹ êµ¬ë¶„**

```{r}
#| eval: false
#| echo: true

# ì„±ë³„ë¡œ ìƒ‰ìƒ êµ¬ë¶„
ggplot(health, aes(x = age, y = bmi, color = gender)) +
  geom_point(size = 3)
```

**ì˜ˆì œ 3: ë‹¤ì¤‘ ë§¤í•‘**

```{r}
#| eval: false
#| echo: true

# ìƒ‰ìƒ + í¬ê¸° + ëª¨ì–‘
ggplot(health, aes(x = age, y = bmi,
                   color = gender,      # ì„±ë³„ë¡œ ìƒ‰ìƒ
                   size = glucose,      # í˜ˆë‹¹ìœ¼ë¡œ í¬ê¸°
                   shape = smoking)) +  # í¡ì—° ì—¬ë¶€ë¡œ ëª¨ì–‘
  geom_point(alpha = 0.7)
```

::: {.callout-warning}
## âš ï¸ aes() ì•ˆ vs. ë°–

**í•µì‹¬ ê·œì¹™**: ë°ì´í„° ë³€ìˆ˜ëŠ” `aes()` **ì•ˆ**ì—, ê³ ì •ê°’ì€ `aes()` **ë°–**ì—

```r
# âœ… ì˜¬ë°”ë¥¸ ì˜ˆ
ggplot(health, aes(x = age, y = bmi, color = gender)) +  # ë³€ìˆ˜ â†’ aes ì•ˆ
  geom_point(size = 3, alpha = 0.7)  # ê³ ì •ê°’ â†’ aes ë°–

# âŒ ì˜ëª»ëœ ì˜ˆ
ggplot(health, aes(x = age, y = bmi, color = "blue")) +  # ëª¨ë“  ì ì´ ë¹¨ê°•!
  geom_point(aes(size = 3))  # ì—ëŸ¬ ë°œìƒ
```

**ì™œ í‹€ë ¸ë‚˜ìš”?**
- `color = "blue"`ë¥¼ `aes()` ì•ˆì— ë„£ìœ¼ë©´ ggplotì€ "blue"ë¼ëŠ” ìƒˆë¡œìš´ ë²”ì£¼ë¡œ í•´ì„
- `size = 3`ì€ ë³€ìˆ˜ê°€ ì•„ë‹ˆë¯€ë¡œ `aes()` ë°–ì— ìˆì–´ì•¼ í•¨
:::

### 2.1.3 ê¸°í•˜í•™ì  ê°ì²´ (Geometries)

**ì •ì˜**: ë°ì´í„°ë¥¼ ì–´ë–¤ ëª¨ì–‘ìœ¼ë¡œ í‘œí˜„í• ì§€ ê²°ì • (`geom_*` í•¨ìˆ˜)

ggplot2ëŠ” 40ê°œ ì´ìƒì˜ geomì„ ì œê³µí•©ë‹ˆë‹¤. ë³´ê±´í•™ ì—°êµ¬ì—ì„œ ìì£¼ ì‚¬ìš©í•˜ëŠ” geomë“¤:

#### **1) ë‹¨ë³€ëŸ‰ ë¶„í¬ (Univariate Distribution)**

**A. íˆìŠ¤í† ê·¸ë¨ (`geom_histogram`)**

ì—°ì†í˜• ë³€ìˆ˜ì˜ ë¶„í¬ë¥¼ ë§‰ëŒ€ë¡œ í‘œí˜„í•©ë‹ˆë‹¤.

```{r}
#| eval: false
#| echo: true

# ë‚˜ì´ ë¶„í¬
ggplot(health, aes(x = age)) +
  geom_histogram(bins = 20, fill = "steelblue", color = "black") +
  labs(title = "ì—°êµ¬ ëŒ€ìƒì ë‚˜ì´ ë¶„í¬",
       x = "ë‚˜ì´ (ì„¸)",
       y = "ë¹ˆë„ (ëª…)") +
  theme_minimal()
```

**ì£¼ìš” ì˜µì…˜:**
- `bins`: ë§‰ëŒ€ ê°œìˆ˜ (ê¸°ë³¸ê°’ 30)
- `binwidth`: ë§‰ëŒ€ ë„ˆë¹„ (ì˜ˆ: `binwidth = 5`ëŠ” 5ì„¸ ë‹¨ìœ„)
- `fill`: ì±„ìš°ê¸° ìƒ‰ìƒ
- `color`: í…Œë‘ë¦¬ ìƒ‰ìƒ

::: {.callout-tip}
## ğŸ’¡ bins vs. binwidth

```r
# bins: ë§‰ëŒ€ ê°œìˆ˜ ì§€ì •
geom_histogram(bins = 10)  # 10ê°œ ë§‰ëŒ€

# binwidth: ë§‰ëŒ€ ë„ˆë¹„ ì§€ì •
geom_histogram(binwidth = 5)  # 5ì„¸ ë‹¨ìœ„ë¡œ ë¬¶ê¸°
```

**ê¶Œì¥**: ë°ì´í„° ë²”ìœ„ì— ë”°ë¼ ì‹¤í—˜í•˜ë©° ìµœì ê°’ ì°¾ê¸°
:::

**B. ë°€ë„ ê³¡ì„  (`geom_density`)**

íˆìŠ¤í† ê·¸ë¨ì˜ ë¶€ë“œëŸ¬ìš´ ë²„ì „ìœ¼ë¡œ, í™•ë¥  ë°€ë„ í•¨ìˆ˜ë¥¼ ì¶”ì •í•©ë‹ˆë‹¤.

```{r}
#| eval: false
#| echo: true

# BMI ë¶„í¬ (ì„±ë³„ ë¹„êµ)
ggplot(health, aes(x = bmi, fill = gender)) +
  geom_density(alpha = 0.5) +
  labs(title = "BMI ë¶„í¬ (ì„±ë³„)",
       x = "ì²´ì§ˆëŸ‰ì§€ìˆ˜ (BMI)",
       y = "ë°€ë„",
       fill = "ì„±ë³„") +
  theme_minimal()
```

**C. ë°•ìŠ¤í”Œë¡¯ (`geom_boxplot`)**

5ê°€ì§€ ìš”ì•½ í†µê³„ë¥¼ í•œëˆˆì— ë³´ì—¬ì¤ë‹ˆë‹¤:
- ì¤‘ì•™ê°’ (median)
- Q1 (25th percentile)
- Q3 (75th percentile)
- ìµœì†Œê°’ (Q1 - 1.5Ã—IQR)
- ìµœëŒ€ê°’ (Q3 + 1.5Ã—IQR)
- ì´ìƒì¹˜ (outliers)

```{r}
#| eval: false
#| echo: true

# ì¹˜ë£Œêµ°ë³„ í˜ˆì•• ë¹„êµ
ggplot(health, aes(x = treatment_group, y = blood_pressure, fill = treatment_group)) +
  geom_boxplot() +
  labs(title = "ì¹˜ë£Œêµ°ë³„ í˜ˆì•• ë¶„í¬",
       x = "ì¹˜ë£Œêµ°",
       y = "ìˆ˜ì¶•ê¸° í˜ˆì•• (mmHg)") +
  theme_minimal() +
  theme(legend.position = "none")  # ë²”ë¡€ ì œê±° (xì¶•ì— ì´ë¯¸ í‘œì‹œ)
```

**D. ë°”ì´ì˜¬ë¦° í”Œë¡¯ (`geom_violin`)**

ë°•ìŠ¤í”Œë¡¯ + ë°€ë„ ê³¡ì„ ì˜ ì¡°í•©ì…ë‹ˆë‹¤.

```{r}
#| eval: false
#| echo: true

ggplot(health, aes(x = treatment_group, y = blood_pressure, fill = treatment_group)) +
  geom_violin(alpha = 0.7) +
  geom_boxplot(width = 0.2, fill = "white") +  # ë°•ìŠ¤í”Œë¡¯ ì¶”ê°€
  labs(title = "ì¹˜ë£Œêµ°ë³„ í˜ˆì•• ë¶„í¬ (Violin Plot)",
       x = "ì¹˜ë£Œêµ°",
       y = "ìˆ˜ì¶•ê¸° í˜ˆì•• (mmHg)") +
  theme_minimal()
```

#### **2) ì´ë³€ëŸ‰ ê´€ê³„ (Bivariate Relationships)**

**A. ì‚°ì ë„ (`geom_point`)**

ë‘ ì—°ì†í˜• ë³€ìˆ˜ì˜ ê´€ê³„ë¥¼ ì ìœ¼ë¡œ í‘œí˜„í•©ë‹ˆë‹¤.

```{r}
#| eval: false
#| echo: true

# ë‚˜ì´ì™€ BMIì˜ ê´€ê³„
ggplot(health, aes(x = age, y = bmi)) +
  geom_point(alpha = 0.5, size = 2) +
  geom_smooth(method = "lm", se = TRUE, color = "red") +  # íšŒê·€ì„ 
  labs(title = "ë‚˜ì´ì™€ BMIì˜ ê´€ê³„",
       x = "ë‚˜ì´ (ì„¸)",
       y = "ì²´ì§ˆëŸ‰ì§€ìˆ˜ (BMI)") +
  theme_minimal()
```

**B. ì„  ê·¸ë˜í”„ (`geom_line`)**

ì‹œê³„ì—´ ë°ì´í„°ë‚˜ ì—°ì†ì ì¸ ì¶”ì„¸ë¥¼ í‘œí˜„í•©ë‹ˆë‹¤.

```{r}
#| eval: false
#| echo: true

# ì›”ë³„ ê°ì—¼ë³‘ ë°œìƒ ì¶”ì´
disease <- read_csv(here("data", "processed", "disease_incidence.csv"))

ggplot(disease, aes(x = month, y = cases)) +
  geom_line(linewidth = 1, color = "darkblue") +
  geom_point(size = 2, color = "darkblue") +
  labs(title = "ì›”ë³„ ê°ì—¼ë³‘ ë°œìƒ ê±´ìˆ˜",
       x = "ì›”",
       y = "ë°œìƒ ê±´ìˆ˜ (ëª…)") +
  theme_minimal()
```

**C. ë§‰ëŒ€ ê·¸ë˜í”„ (`geom_bar` / `geom_col`)**

ë²”ì£¼í˜• ë°ì´í„°ì˜ ë¹ˆë„ ë˜ëŠ” ê°’ì„ í‘œí˜„í•©ë‹ˆë‹¤.

```r
# geom_bar(): ìë™ìœ¼ë¡œ ë¹ˆë„ ê³„ì‚°
ggplot(health, aes(x = gender)) +
  geom_bar()

# geom_col(): yê°’ì„ ì§ì ‘ ì§€ì •
ggplot(summary_data, aes(x = category, y = mean_value)) +
  geom_col()
```

**ì‹¤ì „ ì˜ˆì œ:**

```{r}
#| eval: false
#| echo: true

# ì„±ë³„ ë° í¡ì—° ì—¬ë¶€ë³„ ì¸ì›ìˆ˜
health %>%
  count(gender, smoking) %>%
  ggplot(aes(x = gender, y = n, fill = smoking)) +
  geom_col(position = "dodge") +  # ë§‰ëŒ€ë¥¼ ë‚˜ë€íˆ ë°°ì¹˜
  labs(title = "ì„±ë³„ ë° í¡ì—° ì—¬ë¶€ë³„ ë¶„í¬",
       x = "ì„±ë³„",
       y = "ì¸ì› (ëª…)",
       fill = "í¡ì—° ì—¬ë¶€") +
  theme_minimal()
```

**position ì˜µì…˜:**
- `position = "stack"`: ìŒ“ê¸° (ê¸°ë³¸ê°’)
- `position = "dodge"`: ë‚˜ë€íˆ
- `position = "fill"`: 100% ëˆ„ì 

#### **3) í†µê³„ ìš”ì•½ ì‹œê°í™”**

**A. í‰ê· ê³¼ ì˜¤ì°¨ ë§‰ëŒ€ (`stat_summary` + `geom_errorbar`)**

```{r}
#| eval: false
#| echo: true

# ì¹˜ë£Œêµ°ë³„ í‰ê·  í˜ˆì•• Â± í‘œì¤€ì˜¤ì°¨
ggplot(health, aes(x = treatment_group, y = blood_pressure)) +
  stat_summary(fun = mean, geom = "bar", fill = "steelblue") +
  stat_summary(fun.data = mean_se, geom = "errorbar", width = 0.2) +
  labs(title = "ì¹˜ë£Œêµ°ë³„ í‰ê·  í˜ˆì•• (Mean Â± SE)",
       x = "ì¹˜ë£Œêµ°",
       y = "ìˆ˜ì¶•ê¸° í˜ˆì•• (mmHg)") +
  theme_minimal()
```

**B. íšŒê·€ì„  (`geom_smooth`)**

```{r}
#| eval: false
#| echo: true

# ì„ í˜• íšŒê·€
ggplot(health, aes(x = age, y = bmi)) +
  geom_point(alpha = 0.3) +
  geom_smooth(method = "lm", se = TRUE, color = "red") +
  theme_minimal()

# LOESS (êµ­ì†Œ íšŒê·€)
ggplot(health, aes(x = age, y = bmi)) +
  geom_point(alpha = 0.3) +
  geom_smooth(method = "loess", se = TRUE, color = "blue") +
  theme_minimal()
```

**method ì˜µì…˜:**
- `"lm"`: ì„ í˜• íšŒê·€
- `"loess"`: êµ­ì†Œ íšŒê·€ (ë¹„ì„ í˜•)
- `"gam"`: ì¼ë°˜í™” ê°€ë²• ëª¨ë¸

### 2.1.4 í†µê³„ ë³€í™˜ (Statistical Transformations)

**ì •ì˜**: ì›ë³¸ ë°ì´í„°ë¥¼ ìš”ì•½í•˜ê±°ë‚˜ ë³€í™˜

ëª¨ë“  geomì€ ë‚´ë¶€ì ìœ¼ë¡œ stat í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤:

| geom | ê¸°ë³¸ stat | ë³€í™˜ |
|------|-----------|------|
| `geom_bar()` | `stat_count()` | ë¹ˆë„ ê³„ì‚° |
| `geom_histogram()` | `stat_bin()` | êµ¬ê°„ë³„ ë¹ˆë„ |
| `geom_smooth()` | `stat_smooth()` | íšŒê·€ì„  ì¶”ì • |
| `geom_boxplot()` | `stat_boxplot()` | 5-ìˆ˜ ìš”ì•½ |

**ì˜ˆì œ: stat ì§ì ‘ ì‚¬ìš©**

```{r}
#| eval: false
#| echo: true

# geom_bar()ì™€ ë™ì¼
ggplot(health, aes(x = gender)) +
  stat_count(geom = "bar")

# ë°±ë¶„ìœ¨ë¡œ ë³€í™˜
ggplot(health, aes(x = gender, y = after_stat(count)/sum(after_stat(count)))) +
  geom_bar() +
  scale_y_continuous(labels = scales::percent) +
  labs(y = "ë¹„ìœ¨ (%)")
```

### 2.1.5 ìŠ¤ì¼€ì¼ (Scales)

**ì •ì˜**: ë°ì´í„° ê°’ì„ ì‹œê°ì  ì†ì„±ìœ¼ë¡œ ë³€í™˜í•˜ëŠ” ê·œì¹™

`scale_<aes>_<type>()` í˜•ì‹:
- `<aes>`: x, y, color, fill, size ë“±
- `<type>`: continuous, discrete, manual ë“±

#### **A. ì—°ì†í˜• ìŠ¤ì¼€ì¼**

```{r}
#| eval: false
#| echo: true

# xì¶• ë²”ìœ„ ì¡°ì •
ggplot(health, aes(x = age, y = bmi)) +
  geom_point() +
  scale_x_continuous(limits = c(20, 60),
                     breaks = seq(20, 60, by = 10)) +
  scale_y_continuous(limits = c(15, 35),
                     breaks = seq(15, 35, by = 5))
```

#### **B. ìƒ‰ìƒ ìŠ¤ì¼€ì¼**

```{r}
#| eval: false
#| echo: true

# ìˆ˜ë™ ìƒ‰ìƒ ì§€ì •
ggplot(health, aes(x = age, y = bmi, color = gender)) +
  geom_point() +
  scale_color_manual(values = c("F" = "#E91E63", "M" = "#2196F3"))

# ColorBrewer íŒ”ë ˆíŠ¸
ggplot(health, aes(x = age, y = bmi, color = treatment_group)) +
  geom_point() +
  scale_color_brewer(palette = "Set1")

# Viridis (ìƒ‰ë§¹ ì¹œí™”ì )
ggplot(health, aes(x = age, y = bmi, color = glucose)) +
  geom_point() +
  scale_color_viridis_c(option = "plasma")
```

**ë³´ê±´í•™ ì—°êµ¬ ê¶Œì¥ ìƒ‰ìƒ íŒ”ë ˆíŠ¸:**
- **ë²”ì£¼í˜•**: ColorBrewer "Set1", "Dark2"
- **ì—°ì†í˜•**: Viridis "viridis", "plasma" (ìƒ‰ë§¹ ì¹œí™”ì )
- **ë°œì‚°í˜•**: ColorBrewer "RdBu" (ìœ„í—˜ë„ í‘œí˜„)

#### **C. ë¡œê·¸ ìŠ¤ì¼€ì¼**

ì—­í•™ ë°ì´í„°ì—ì„œ ìì£¼ ì‚¬ìš©ë©ë‹ˆë‹¤ (ë°œìƒë¥ , ì˜¤ì¦ˆë¹„ ë“±).

```{r}
#| eval: false
#| echo: true

# yì¶•ì„ ë¡œê·¸ ìŠ¤ì¼€ì¼ë¡œ
ggplot(disease, aes(x = month, y = cases)) +
  geom_line() +
  scale_y_log10() +
  labs(y = "ë°œìƒ ê±´ìˆ˜ (log scale)")
```

### 2.1.6 ì¢Œí‘œê³„ (Coordinate System)

**ì •ì˜**: ë°ì´í„°ë¥¼ í‰ë©´ì— ë°°ì¹˜í•˜ëŠ” ë°©ì‹

#### **A. ì¶• ë’¤ì§‘ê¸° (`coord_flip`)**

```{r}
#| eval: false
#| echo: true

# ìˆ˜í‰ ë§‰ëŒ€ ê·¸ë˜í”„
ggplot(health, aes(x = reorder(region, -cases), y = cases)) +
  geom_col() +
  coord_flip() +  # xì™€ y ì¶• êµí™˜
  labs(x = "ì§€ì—­", y = "ë°œìƒ ê±´ìˆ˜")
```

#### **B. ê³ ì • ë¹„ìœ¨ (`coord_fixed`)**

```{r}
#| eval: false
#| echo: true

# xì¶•ê³¼ yì¶• ë¹„ìœ¨ 1:1 ê³ ì •
ggplot(health, aes(x = predicted_bmi, y = actual_bmi)) +
  geom_point() +
  geom_abline(slope = 1, intercept = 0, color = "red") +  # y=x ì„ 
  coord_fixed(ratio = 1) +
  labs(title = "ì˜ˆì¸¡ BMI vs. ì‹¤ì œ BMI")
```

#### **C. ê·¹ì¢Œí‘œ (`coord_polar`)**

íŒŒì´ ì°¨íŠ¸ë‚˜ ë°©ì‚¬í˜• ê·¸ë˜í”„ì— ì‚¬ìš©ë©ë‹ˆë‹¤.

```{r}
#| eval: false
#| echo: true

# íŒŒì´ ì°¨íŠ¸
health %>%
  count(gender) %>%
  ggplot(aes(x = "", y = n, fill = gender)) +
  geom_col() +
  coord_polar(theta = "y") +
  theme_void() +
  labs(title = "ì„±ë³„ ë¶„í¬")
```

::: {.callout-warning}
## âš ï¸ íŒŒì´ ì°¨íŠ¸ ì‚¬ìš© ì£¼ì˜

íŒŒì´ ì°¨íŠ¸ëŠ” ì‹œê°ì ìœ¼ë¡œ ë§¤ë ¥ì ì´ì§€ë§Œ, ì¸ê°„ì˜ ëˆˆì€ **ê°ë„ë³´ë‹¤ ê¸¸ì´ë¥¼ ë” ì •í™•í•˜ê²Œ ë¹„êµ**í•©ë‹ˆë‹¤.

**ì¶”ì²œ**: 3ê°œ ì´í•˜ì˜ ë²”ì£¼ë§Œ ìˆì„ ë•Œ ì‚¬ìš©. ê·¸ ì™¸ì—ëŠ” ë§‰ëŒ€ ê·¸ë˜í”„ ê¶Œì¥.
:::

### 2.1.7 ë©´ë¶„í•  (Faceting)

**ì •ì˜**: í•˜ë‚˜ì˜ ë³€ìˆ˜ë¡œ ì—¬ëŸ¬ ê°œì˜ í•˜ìœ„ ê·¸ë˜í”„ë¡œ ë¶„í• 

#### **A. `facet_wrap()`: 1ì°¨ì› ë¶„í• **

```{r}
#| eval: false
#| echo: true

# ì„±ë³„ë¡œ ë¶„í• 
ggplot(health, aes(x = age, y = bmi)) +
  geom_point() +
  facet_wrap(~ gender) +
  labs(title = "ë‚˜ì´ì™€ BMIì˜ ê´€ê³„ (ì„±ë³„)")
```

**ì£¼ìš” ì˜µì…˜:**
- `ncol`: ì—´ ê°œìˆ˜
- `nrow`: í–‰ ê°œìˆ˜
- `scales`: ì¶• ìŠ¤ì¼€ì¼ ("fixed", "free", "free_x", "free_y")

```{r}
#| eval: false
#| echo: true

# ì¹˜ë£Œêµ°ë³„ë¡œ 4ì—´ë¡œ ë°°ì¹˜
ggplot(health, aes(x = age, y = bmi)) +
  geom_point() +
  facet_wrap(~ treatment_group, ncol = 4, scales = "free_y")
```

#### **B. `facet_grid()`: 2ì°¨ì› ë¶„í• **

```{r}
#| eval: false
#| echo: true

# ì„±ë³„(í–‰) Ã— í¡ì—° ì—¬ë¶€(ì—´)
ggplot(health, aes(x = age, y = bmi)) +
  geom_point() +
  facet_grid(gender ~ smoking) +
  labs(title = "ë‚˜ì´ì™€ BMI (ì„±ë³„ Ã— í¡ì—° ì—¬ë¶€)")
```

**ë¬¸ë²•:**
- `facet_grid(rows ~ cols)`
- `facet_grid(. ~ cols)`: í–‰ë§Œ
- `facet_grid(rows ~ .)`: ì—´ë§Œ

::: {.callout-note}
## ğŸ’¡ facet_wrap vs. facet_grid

| íŠ¹ì§• | `facet_wrap()` | `facet_grid()` |
|------|----------------|----------------|
| ì°¨ì› | 1ì°¨ì› | 2ì°¨ì› |
| ë ˆì´ì•„ì›ƒ | ìë™ ê°ì‹¸ê¸° | ê²©ì êµ¬ì¡° |
| ì¶• ê³µìœ  | ì„ íƒ ê°€ëŠ¥ | í–‰/ì—´ë³„ ê³µìœ  |
| ì‚¬ìš© ì˜ˆ | ì—¬ëŸ¬ ì§€ì—­ ë¹„êµ | ì„±ë³„Ã—ì—°ë ¹êµ° êµì°¨ ë¶„ì„ |

**ê²½í—˜ ë²•ì¹™**: ë³€ìˆ˜ 1ê°œ â†’ `facet_wrap`, ë³€ìˆ˜ 2ê°œ â†’ `facet_grid`
:::

## 2.2 aes() í•¨ìˆ˜ ì™„ì „ ì •ë³µ

### 2.2.1 Global vs. Local Aesthetics

**Global aes**: `ggplot()`ì— ì •ì˜ â†’ ëª¨ë“  ë ˆì´ì–´ì— ì ìš©

```{r}
#| eval: false
#| echo: true

ggplot(health, aes(x = age, y = bmi)) +  # Global
  geom_point() +
  geom_smooth()  # ë‘˜ ë‹¤ ageì™€ bmi ì‚¬ìš©
```

**Local aes**: íŠ¹ì • geomì—ë§Œ ì •ì˜ â†’ í•´ë‹¹ ë ˆì´ì–´ì—ë§Œ ì ìš©

```{r}
#| eval: false
#| echo: true

ggplot(health, aes(x = age, y = bmi)) +
  geom_point(aes(color = gender)) +  # ì ë§Œ ìƒ‰ìƒ
  geom_smooth()  # ì „ì²´ ë°ì´í„°ë¡œ íšŒê·€ì„ 
```

### 2.2.2 Aesthetic ìš°ì„ ìˆœìœ„

Local aesê°€ Global aesë¥¼ ë®ì–´ì”ë‹ˆë‹¤.

```{r}
#| eval: false
#| echo: true

ggplot(health, aes(x = age, y = bmi, color = gender)) +  # Global: ì„±ë³„ë¡œ ìƒ‰ìƒ
  geom_point() +
  geom_smooth(aes(color = NULL))  # Local: ìƒ‰ìƒ ë¬´ì‹œ, ì „ì²´ ë°ì´í„°ë¡œ íšŒê·€ì„ 
```

### 2.2.3 ê³„ì‚°ëœ ë³€ìˆ˜ (Computed Variables)

ì¼ë¶€ geomì€ ê³„ì‚°ëœ ë³€ìˆ˜ë¥¼ ì œê³µí•©ë‹ˆë‹¤. `after_stat()`ë¡œ ì ‘ê·¼í•©ë‹ˆë‹¤.

```{r}
#| eval: false
#| echo: true

# íˆìŠ¤í† ê·¸ë¨ì—ì„œ ë°€ë„ë¡œ ë³€í™˜
ggplot(health, aes(x = bmi)) +
  geom_histogram(aes(y = after_stat(density)), bins = 30) +
  geom_density(color = "red", linewidth = 1) +
  labs(y = "ë°€ë„")
```

**ìì£¼ ì‚¬ìš©ë˜ëŠ” ê³„ì‚° ë³€ìˆ˜:**
- `geom_histogram`: `count`, `density`, `ncount`, `ndensity`
- `geom_smooth`: `y`, `ymin`, `ymax`, `se`
- `stat_summary`: `y`, `ymin`, `ymax`

## 2.3 ë³´ê±´í•™ ë°ì´í„° ì‹œê°í™” ì‹¤ì „

### 2.3.1 ì—°ì†í˜• ë³€ìˆ˜ì˜ ë¶„í¬

**ëª©í‘œ**: ë°ì´í„°ì˜ ì¤‘ì‹¬, ì‚°í¬, ì´ìƒì¹˜ íŒŒì•…

```{r}
#| eval: false
#| echo: true

library(tidyverse)
library(patchwork)  # ê·¸ë˜í”„ ì¡°í•©

health <- read_csv(here::here("data", "processed", "health_survey.csv"))

# 1) íˆìŠ¤í† ê·¸ë¨
p1 <- ggplot(health, aes(x = bmi)) +
  geom_histogram(bins = 30, fill = "steelblue", color = "black") +
  labs(title = "BMI ë¶„í¬ (íˆìŠ¤í† ê·¸ë¨)",
       x = "BMI", y = "ë¹ˆë„") +
  theme_minimal()

# 2) ë°€ë„ ê³¡ì„ 
p2 <- ggplot(health, aes(x = bmi)) +
  geom_density(fill = "steelblue", alpha = 0.5) +
  labs(title = "BMI ë¶„í¬ (ë°€ë„ ê³¡ì„ )",
       x = "BMI", y = "ë°€ë„") +
  theme_minimal()

# 3) ë°•ìŠ¤í”Œë¡¯
p3 <- ggplot(health, aes(y = bmi)) +
  geom_boxplot(fill = "steelblue") +
  labs(title = "BMI ë¶„í¬ (ë°•ìŠ¤í”Œë¡¯)",
       y = "BMI") +
  theme_minimal()

# 4) ë°”ì´ì˜¬ë¦° í”Œë¡¯
p4 <- ggplot(health, aes(x = "", y = bmi)) +
  geom_violin(fill = "steelblue", alpha = 0.5) +
  geom_boxplot(width = 0.2, fill = "white") +
  labs(title = "BMI ë¶„í¬ (ë°”ì´ì˜¬ë¦°)",
       x = "", y = "BMI") +
  theme_minimal()

# 4ê°œ ê·¸ë˜í”„ ì¡°í•©
(p1 + p2) / (p3 + p4) +
  plot_annotation(title = "BMI ë¶„í¬ì˜ ë‹¤ì–‘í•œ ì‹œê°í™”",
                  tag_levels = "A")
```

### 2.3.2 ë²”ì£¼í˜• Ã— ì—°ì†í˜• ë³€ìˆ˜

**ëª©í‘œ**: ê·¸ë£¹ ê°„ ì°¨ì´ ë¹„êµ

```{r}
#| eval: false
#| echo: true

# ì„±ë³„ Ã— BMI
ggplot(health, aes(x = gender, y = bmi, fill = gender)) +
  geom_boxplot(alpha = 0.7) +
  geom_jitter(width = 0.2, alpha = 0.2) +  # ê°œë³„ ë°ì´í„° ì  ì¶”ê°€
  stat_summary(fun = mean, geom = "point",
               shape = 18, size = 3, color = "red") +  # í‰ê· ê°’ í‘œì‹œ
  labs(title = "ì„±ë³„ì— ë”°ë¥¸ BMI ë¶„í¬",
       x = "ì„±ë³„",
       y = "ì²´ì§ˆëŸ‰ì§€ìˆ˜ (BMI)") +
  theme_minimal() +
  theme(legend.position = "none")
```

### 2.3.3 ì‹œê³„ì—´ ë°ì´í„°

**ëª©í‘œ**: ì‹œê°„ì— ë”°ë¥¸ ë³€í™” ì¶”ì´ íŒŒì•…

```{r}
#| eval: false
#| echo: true

disease <- read_csv(here::here("data", "processed", "disease_incidence.csv"))

# ì›”ë³„ ë°œìƒ ì¶”ì´
ggplot(disease, aes(x = month, y = cases)) +
  geom_line(linewidth = 1, color = "darkblue") +
  geom_point(size = 2, color = "darkblue") +
  geom_smooth(method = "loess", se = TRUE, color = "red", alpha = 0.2) +
  labs(title = "ì›”ë³„ ê°ì—¼ë³‘ ë°œìƒ ì¶”ì´",
       x = "ì›”",
       y = "ë°œìƒ ê±´ìˆ˜ (ëª…)") +
  scale_x_continuous(breaks = 1:12) +
  theme_minimal()
```

### 2.3.4 ìƒê´€ê´€ê³„ ì‹œê°í™”

**ëª©í‘œ**: ë‘ ì—°ì†í˜• ë³€ìˆ˜ ê°„ ê´€ê³„ íƒìƒ‰

```{r}
#| eval: false
#| echo: true

# BMIì™€ í˜ˆë‹¹ì˜ ê´€ê³„
ggplot(health, aes(x = bmi, y = glucose)) +
  geom_point(alpha = 0.5, size = 2) +
  geom_smooth(method = "lm", se = TRUE, color = "red") +
  geom_hline(yintercept = 126, linetype = "dashed", color = "orange") +  # ë‹¹ë‡¨ ê¸°ì¤€ì„ 
  annotate("text", x = 20, y = 130, label = "ë‹¹ë‡¨ ê¸°ì¤€ (126 mg/dL)",
           color = "orange", hjust = 0) +
  labs(title = "BMIì™€ ê³µë³µ í˜ˆë‹¹ì˜ ê´€ê³„",
       subtitle = paste0("ìƒê´€ê³„ìˆ˜ r = ",
                         round(cor(health$bmi, health$glucose, use = "complete.obs"), 2)),
       x = "ì²´ì§ˆëŸ‰ì§€ìˆ˜ (BMI)",
       y = "ê³µë³µ í˜ˆë‹¹ (mg/dL)") +
  theme_minimal()
```

## 2.4 ì¸µí™”(Stratification)ì™€ ì—­í•™ì  ì‚¬ê³ 

**ì¸µí™”(Stratification)**ëŠ” ì—­í•™ ì—°êµ¬ì˜ í•µì‹¬ ê°œë…ì…ë‹ˆë‹¤. í˜¼ë€ ë³€ìˆ˜(confounders)ì˜ ì˜í–¥ì„ íŒŒì•…í•˜ê³  ì œê±°í•˜ê¸° ìœ„í•´ ì‚¬ìš©ë©ë‹ˆë‹¤.

### 2.4.1 Simpsonì˜ ì—­ì„¤ (Simpson's Paradox)

ì „ì²´ ë°ì´í„°ì—ì„œ ë³´ì´ëŠ” ê´€ê³„ê°€ í•˜ìœ„ ê·¸ë£¹ì—ì„œëŠ” ë°˜ëŒ€ë¡œ ë‚˜íƒ€ë‚˜ëŠ” í˜„ìƒì…ë‹ˆë‹¤.

**ì˜ˆì œ: ì¹˜ë£Œ íš¨ê³¼ í‰ê°€**

```{r}
#| eval: false
#| echo: true

# ì‹œë®¬ë ˆì´ì…˜ ë°ì´í„°
simpsons_data <- tibble(
  age_group = rep(c("Young", "Old"), each = 100),
  treatment = rep(c("A", "B"), 100),
  recovery_rate = c(
    rnorm(50, mean = 80, sd = 10),  # Young + A
    rnorm(50, mean = 75, sd = 10),  # Young + B
    rnorm(50, mean = 60, sd = 10),  # Old + A
    rnorm(50, mean = 55, sd = 10)   # Old + B
  )
)

# 1) ì „ì²´ ë°ì´í„° (ì¸µí™” ì—†ìŒ)
p1 <- simpsons_data %>%
  group_by(treatment) %>%
  summarize(mean_recovery = mean(recovery_rate)) %>%
  ggplot(aes(x = treatment, y = mean_recovery, fill = treatment)) +
  geom_col() +
  labs(title = "ì „ì²´ í‰ê·  (ì¸µí™” X)",
       y = "íšŒë³µë¥  (%)") +
  theme_minimal() +
  theme(legend.position = "none")

# 2) ì—°ë ¹êµ°ë³„ ì¸µí™”
p2 <- simpsons_data %>%
  ggplot(aes(x = treatment, y = recovery_rate, fill = treatment)) +
  geom_boxplot() +
  facet_wrap(~ age_group) +
  labs(title = "ì—°ë ¹êµ°ë³„ íšŒë³µë¥  (ì¸µí™” O)",
       y = "íšŒë³µë¥  (%)") +
  theme_minimal() +
  theme(legend.position = "none")

library(patchwork)
p1 + p2 +
  plot_annotation(title = "Simpson's Paradox: ì¸µí™”ì˜ ì¤‘ìš”ì„±")
```

### 2.4.2 í˜¼ë€ ë³€ìˆ˜ í†µì œ

```{r}
#| eval: false
#| echo: true

# BMIì™€ í˜ˆì••ì˜ ê´€ê³„ (ì—°ë ¹ ì¸µí™”)
health %>%
  mutate(age_group = cut(age, breaks = c(0, 30, 40, 50, 100),
                         labels = c("20ëŒ€", "30ëŒ€", "40ëŒ€", "50ëŒ€+"))) %>%
  ggplot(aes(x = bmi, y = sbp, color = age_group)) +
  geom_point(alpha = 0.5) +
  geom_smooth(method = "lm", se = FALSE) +
  facet_wrap(~ age_group, ncol = 2) +
  labs(title = "BMIì™€ ìˆ˜ì¶•ê¸° í˜ˆì••ì˜ ê´€ê³„ (ì—°ë ¹êµ°ë³„)",
       x = "ì²´ì§ˆëŸ‰ì§€ìˆ˜ (BMI)",
       y = "ìˆ˜ì¶•ê¸° í˜ˆì•• (mmHg)",
       color = "ì—°ë ¹êµ°") +
  theme_minimal()
```

### 2.4.3 êµí˜¸ì‘ìš©(Interaction) íƒìƒ‰

```{r}
#| eval: false
#| echo: true

# ì„±ë³„ì— ë”°ë¼ BMI-í˜ˆì•• ê´€ê³„ê°€ ë‹¤ë¥¸ê°€?
ggplot(health, aes(x = bmi, y = sbp, color = gender)) +
  geom_point(alpha = 0.3) +
  geom_smooth(method = "lm", se = TRUE, linewidth = 1.5) +
  labs(title = "BMIì™€ í˜ˆì••ì˜ ê´€ê³„ (ì„±ë³„ ë¹„êµ)",
       subtitle = "ê¸°ìš¸ê¸°ê°€ ë‹¤ë¥´ë‹¤ â†’ êµí˜¸ì‘ìš© ì¡´ì¬",
       x = "ì²´ì§ˆëŸ‰ì§€ìˆ˜ (BMI)",
       y = "ìˆ˜ì¶•ê¸° í˜ˆì•• (mmHg)",
       color = "ì„±ë³„") +
  theme_minimal()
```

## 2.5 ì‹¤ì „ ì—°ìŠµë¬¸ì œ

::: {.callout-tip icon="false"}
## âœï¸ Exercise 2.1: ê¸°ë³¸ geom ë§ˆìŠ¤í„°

`health_survey.csv` ë°ì´í„°ë¥¼ ì‚¬ìš©í•˜ì—¬:

1. í˜ˆë‹¹(glucose) ë¶„í¬ íˆìŠ¤í† ê·¸ë¨ (bins = 30)
2. ì„±ë³„(gender)ë¡œ êµ¬ë¶„í•œ í˜ˆë‹¹ ë°€ë„ ê³¡ì„ 
3. ì„±ë³„(gender)ì— ë”°ë¥¸ í˜ˆì••(sbp) ë°•ìŠ¤í”Œë¡¯
4. ë‚˜ì´(age)ì™€ ì½œë ˆìŠ¤í…Œë¡¤(cholesterol)ì˜ ì‚°ì ë„ + íšŒê·€ì„ 

```{r}
#| eval: false
#| code-fold: true
#| code-summary: "ğŸ’¡ ì •ë‹µ ë³´ê¸°"

library(tidyverse)
library(patchwork)

health <- read_csv(here::here("data", "processed", "health_survey.csv"))

# 1. íˆìŠ¤í† ê·¸ë¨
p1 <- ggplot(health, aes(x = glucose)) +
  geom_histogram(bins = 30, fill = "steelblue", color = "black") +
  labs(title = "í˜ˆë‹¹ ë¶„í¬", x = "í˜ˆë‹¹ (mg/dL)", y = "ë¹ˆë„") +
  theme_minimal()

# 2. ë°€ë„ ê³¡ì„  (ì„±ë³„)
p2 <- ggplot(health, aes(x = glucose, fill = gender)) +
  geom_density(alpha = 0.5) +
  labs(title = "í˜ˆë‹¹ ë¶„í¬ (ì„±ë³„)", x = "í˜ˆë‹¹ (mg/dL)", y = "ë°€ë„") +
  theme_minimal()

# 3. ë°•ìŠ¤í”Œë¡¯
p3 <- ggplot(health, aes(x = gender, y = sbp, fill = gender)) +
  geom_boxplot() +
  labs(title = "í˜ˆì•• ë¶„í¬ (ì„±ë³„)", x = "ì„±ë³„", y = "ìˆ˜ì¶•ê¸° í˜ˆì•• (mmHg)") +
  theme_minimal() +
  theme(legend.position = "none")

# 4. ì‚°ì ë„ + íšŒê·€ì„ 
p4 <- ggplot(health, aes(x = age, y = cholesterol)) +
  geom_point(alpha = 0.5) +
  geom_smooth(method = "lm", se = TRUE, color = "red") +
  labs(title = "ë‚˜ì´ì™€ ì½œë ˆìŠ¤í…Œë¡¤", x = "ë‚˜ì´ (ì„¸)", y = "ì´ ì½œë ˆìŠ¤í…Œë¡¤ (mg/dL)") +
  theme_minimal()

# ì¡°í•©
(p1 + p2) / (p3 + p4) +
  plot_annotation(tag_levels = "A")
```
:::

::: {.callout-tip icon="false"}
## âœï¸ Exercise 2.2: Faceting ì‹¤ìŠµ

`health_survey.csv` ë°ì´í„°ì—ì„œ:

1. ì„±ë³„(gender)ê³¼ í¡ì—° ì—¬ë¶€(smoking)ë¡œ 2ì°¨ì› facet
2. ê° facetì— BMI íˆìŠ¤í† ê·¸ë¨ í‘œì‹œ
3. ê° facetë§ˆë‹¤ ì¶• ìŠ¤ì¼€ì¼ ììœ ë¡­ê²Œ ì¡°ì •

```{r}
#| eval: false
#| code-fold: true
#| code-summary: "ğŸ’¡ ì •ë‹µ ë³´ê¸°"

health %>%
  ggplot(aes(x = bmi)) +
  geom_histogram(bins = 20, fill = "steelblue", color = "black") +
  facet_grid(gender ~ smoking, scales = "free_y") +
  labs(title = "BMI ë¶„í¬ (ì„±ë³„ Ã— í¡ì—° ì—¬ë¶€)",
       x = "ì²´ì§ˆëŸ‰ì§€ìˆ˜ (BMI)",
       y = "ë¹ˆë„ (ëª…)") +
  theme_minimal()
```
:::

::: {.callout-tip icon="false"}
## âœï¸ Exercise 2.3: ìƒ‰ìƒ ìŠ¤ì¼€ì¼ ì¡°ì •

`health_survey.csv` ë°ì´í„°ì—ì„œ:

1. BMIì™€ í˜ˆë‹¹ì˜ ì‚°ì ë„
2. ì  ìƒ‰ìƒì„ ë‚˜ì´(age)ì— ë§¤í•‘
3. Viridis "plasma" ìƒ‰ìƒ íŒ”ë ˆíŠ¸ ì‚¬ìš©
4. ìƒ‰ìƒ ë²”ë¡€ ì œëª©ì„ "ë‚˜ì´ (ì„¸)"ë¡œ ë³€ê²½

```{r}
#| eval: false
#| code-fold: true
#| code-summary: "ğŸ’¡ ì •ë‹µ ë³´ê¸°"

ggplot(health, aes(x = bmi, y = glucose, color = age)) +
  geom_point(size = 2, alpha = 0.7) +
  scale_color_viridis_c(option = "plasma", name = "ë‚˜ì´ (ì„¸)") +
  labs(title = "BMI, í˜ˆë‹¹, ë‚˜ì´ì˜ ê´€ê³„",
       x = "ì²´ì§ˆëŸ‰ì§€ìˆ˜ (BMI)",
       y = "ê³µë³µ í˜ˆë‹¹ (mg/dL)") +
  theme_minimal()
```
:::

::: {.callout-tip icon="false"}
## âœï¸ Exercise 2.4: ì¸µí™” ë¶„ì„ (ë„ì „!)

`health_survey.csv` ë°ì´í„°ì—ì„œ:

1. BMI(x)ì™€ ìˆ˜ì¶•ê¸° í˜ˆì••(y)ì˜ ê´€ê³„ ì‹œê°í™”
2. ì„±ë³„(color)ë¡œ êµ¬ë¶„
3. ì—°ë ¹êµ°(age_group: 20ëŒ€, 30ëŒ€, 40ëŒ€, 50ëŒ€+)ìœ¼ë¡œ facet
4. ê° ê·¸ë£¹ë³„ íšŒê·€ì„  ì¶”ê°€

**íŒíŠ¸**: `cut()` í•¨ìˆ˜ë¡œ ì—°ë ¹êµ° ìƒì„±

```{r}
#| eval: false
#| code-fold: true
#| code-summary: "ğŸ’¡ ì •ë‹µ ë³´ê¸°"

health %>%
  mutate(age_group = cut(age,
                         breaks = c(0, 30, 40, 50, 100),
                         labels = c("20ëŒ€", "30ëŒ€", "40ëŒ€", "50ëŒ€+"))) %>%
  ggplot(aes(x = bmi, y = sbp, color = gender)) +
  geom_point(alpha = 0.4, size = 1.5) +
  geom_smooth(method = "lm", se = FALSE, linewidth = 1) +
  facet_wrap(~ age_group, ncol = 2) +
  scale_color_manual(values = c("F" = "#E91E63", "M" = "#2196F3"),
                     labels = c("F" = "ì—¬ì„±", "M" = "ë‚¨ì„±")) +
  labs(title = "BMIì™€ ìˆ˜ì¶•ê¸° í˜ˆì••ì˜ ê´€ê³„ (ì„±ë³„ Ã— ì—°ë ¹êµ°)",
       x = "ì²´ì§ˆëŸ‰ì§€ìˆ˜ (BMI)",
       y = "ìˆ˜ì¶•ê¸° í˜ˆì•• (mmHg)",
       color = "ì„±ë³„") +
  theme_minimal() +
  theme(legend.position = "bottom")
```
:::

## 2.6 ìš”ì•½ ë° ë‹¤ìŒ ë‹¨ê³„

### 2.6.1 ì´ ì±•í„°ì—ì„œ ë°°ìš´ ë‚´ìš©

âœ… **ê·¸ë˜í”½ ë¬¸ë²•ì˜ 7ê°€ì§€ êµ¬ì„± ìš”ì†Œ**
1. Data: Tidy data í˜•ì‹
2. Aesthetics: `aes()` í•¨ìˆ˜ë¡œ ë³€ìˆ˜ ë§¤í•‘
3. Geometries: 20ê°œ ì´ìƒì˜ `geom_*` í•¨ìˆ˜
4. Statistics: ë°ì´í„° ë³€í™˜ê³¼ ìš”ì•½
5. Scales: ì—°ì†í˜•/ë²”ì£¼í˜•/ìƒ‰ìƒ ìŠ¤ì¼€ì¼
6. Coordinates: ì¶• ì¡°ì •, flip, polar
7. Facets: `facet_wrap()`, `facet_grid()`

âœ… **ë³´ê±´í•™ ë°ì´í„° ì‹œê°í™” ì‹¤ì „**
- ë‹¨ë³€ëŸ‰ ë¶„í¬: íˆìŠ¤í† ê·¸ë¨, ë°€ë„, ë°•ìŠ¤í”Œë¡¯
- ì´ë³€ëŸ‰ ê´€ê³„: ì‚°ì ë„, íšŒê·€ì„ 
- ì‹œê³„ì—´: ì„  ê·¸ë˜í”„
- ì¸µí™” ë¶„ì„: facetì„ í™œìš©í•œ í˜¼ë€ ë³€ìˆ˜ í†µì œ

âœ… **ì—­í•™ì  ì‚¬ê³ **
- Simpsonì˜ ì—­ì„¤
- í˜¼ë€ ë³€ìˆ˜ í†µì œ
- êµí˜¸ì‘ìš© íƒìƒ‰

### 2.6.2 í•µì‹¬ ì½”ë“œ í…œí”Œë¦¿

**ê¸°ë³¸ êµ¬ì¡°:**
```r
ggplot(data = <DATA>, mapping = aes(<MAPPINGS>)) +
  <GEOM_FUNCTION>() +
  <SCALE_FUNCTION>() +
  <FACET_FUNCTION>() +
  <COORD_FUNCTION>() +
  labs(<LABELS>) +
  theme_<THEME>()
```

**ì¸µí™” ë¶„ì„ í…œí”Œë¦¿:**
```r
data %>%
  mutate(strata_var = cut(...)) %>%
  ggplot(aes(x = exposure, y = outcome, color = confounder)) +
  geom_point(alpha = 0.5) +
  geom_smooth(method = "lm") +
  facet_wrap(~ strata_var) +
  theme_minimal()
```

### 2.6.3 ìì£¼ ì‚¬ìš©í•˜ëŠ” geom ì •ë¦¬

| ëª©ì  | geom | ì˜ˆì œ |
|------|------|------|
| ë‹¨ë³€ëŸ‰ ë¶„í¬ | `geom_histogram()` | ë‚˜ì´ ë¶„í¬ |
| ë‹¨ë³€ëŸ‰ ë¶„í¬ | `geom_density()` | BMI ë¶„í¬ (ë¶€ë“œëŸ¬ìš´) |
| ê·¸ë£¹ ë¹„êµ | `geom_boxplot()` | ì¹˜ë£Œêµ°ë³„ í˜ˆì•• |
| ê·¸ë£¹ ë¹„êµ | `geom_violin()` | ì„±ë³„ BMI ë¶„í¬ |
| ìƒê´€ê´€ê³„ | `geom_point()` | BMI vs. í˜ˆë‹¹ |
| ì¶”ì„¸ì„  | `geom_smooth()` | íšŒê·€ì„ , LOESS |
| ì‹œê³„ì—´ | `geom_line()` | ì›”ë³„ ë°œìƒë¥  |
| ë²”ì£¼í˜• ë¹ˆë„ | `geom_bar()` | ì„±ë³„ ë¶„í¬ |
| í‰ê·  ë¹„êµ | `geom_col()` + `geom_errorbar()` | í‰ê·  Â± SE |

::: {.callout-important}
## ğŸ“– ë‹¤ìŒ ì±•í„°

**[Chapter 3: ì—­í•™ ë°ì´í„° ì‹œê°í™”](03-epidemiology.qmd)**

Chapter 3ì—ì„œëŠ” ì—­í•™ ì—°êµ¬ì— íŠ¹í™”ëœ ì‹œê°í™”ë¥¼ ë°°ì›ë‹ˆë‹¤:

1. **ìœ í–‰ ê³¡ì„  (Epidemic Curve)**: `incidence2` íŒ¨í‚¤ì§€
2. **ë°œìƒë¥ ê³¼ ìœ ë³‘ë¥ **: ì‹œê³„ì—´ ë¶„ì„
3. **ì—°ë ¹ í‘œì¤€í™” ë¹„ìœ¨**: ì¸êµ¬ í”¼ë¼ë¯¸ë“œ
4. **ìƒì¡´ ê³¡ì„  ê¸°ì´ˆ**: Kaplan-Meier ê³¡ì„  ë¯¸ë¦¬ë³´ê¸°

ì‹¤ì œ ê°ì—¼ë³‘ ë°ì´í„°ì™€ ì½”í˜¸íŠ¸ ì—°êµ¬ ë°ì´í„°ë¥¼ í™œìš©í•©ë‹ˆë‹¤!
:::

::: {.callout-note}
## ğŸ”— ì¶”ê°€ í•™ìŠµ ìë£Œ

### ggplot2 ì‹¬í™”
- **ggplot2 Book**: [https://ggplot2-book.org/](https://ggplot2-book.org/)
- **R Graph Gallery**: [https://r-graph-gallery.com/](https://r-graph-gallery.com/)
- **ggplot2 Cheat Sheet**: [RStudio Cheat Sheets](https://posit.co/resources/cheatsheets/)

### ìƒ‰ìƒ ì„ íƒ
- **ColorBrewer**: [https://colorbrewer2.org/](https://colorbrewer2.org/)
- **Viridis**: [Viridis íŒ¨í‚¤ì§€ ë¬¸ì„œ](https://cran.r-project.org/web/packages/viridis/vignettes/intro-to-viridis.html)
- **ìƒ‰ë§¹ ì‹œë®¬ë ˆì´í„°**: [Coblis](https://www.color-blindness.com/coblis-color-blindness-simulator/)

### ë³´ê±´í•™ ì‹œê°í™” ì˜ˆì œ
- **Our World in Data**: [https://ourworldindata.org/](https://ourworldindata.org/)
- **CDC Data Visualizations**: [https://www.cdc.gov/](https://www.cdc.gov/)
- **Epi R Handbook**: [https://epirhandbook.com/](https://epirhandbook.com/)
:::
