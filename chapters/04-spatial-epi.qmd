---
title: "ê³µê°„ ì—­í•™ ë°ì´í„° ì‹œê°í™”"
author: "ì—°ì„¸ëŒ€ ì‚°ì—…ë³´ê±´ ì—°êµ¬ì†Œ"
date: today
---

```{r setup, include=FALSE}
# í•œê¸€ í°íŠ¸ ì„¤ì •
library(showtext)
library(sysfonts)
font_add_google("Noto Sans KR", "noto")
showtext_auto()

library(ggplot2)
theme_set(theme_grey(base_family = "noto"))
showtext_opts(dpi = 96)

knitr::opts_chunk$set(
  fig.showtext = TRUE,
  dev = "png",
  dpi = 96
)
```

# ê³µê°„ ì—­í•™ ë°ì´í„° ì‹œê°í™”

::: {.callout-note}
## ğŸ¯ í•™ìŠµ ëª©í‘œ

ì´ ì±•í„°ë¥¼ ë§ˆì¹˜ë©´ ë‹¤ìŒì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

- **sf íŒ¨í‚¤ì§€**ë¡œ ê³µê°„ ë°ì´í„°ë¥¼ Rì—ì„œ ì²˜ë¦¬
- ì—­í•™ ë°ì´í„°ì™€ ì§€ë¦¬ ë°ì´í„° ê²°í•©í•˜ì—¬ ì½”ë¡œí”Œë ˆìŠ¤ ë§µ ì œì‘
- **ggplot2**ì™€ **tmap**ìœ¼ë¡œ ì „ë¬¸ì ì¸ ì§€ë„ ì‹œê°í™”
- ê³µê°„ íŒ¨í„´ì„ í•´ì„í•˜ê³  í´ëŸ¬ìŠ¤í„° íƒì§€
- ì§€ì—­ë³„ ì§ˆë³‘ ë¶€ë‹´ ë¹„êµ ë° í‘œì¤€í™”
:::

::: {.callout-tip}
## ğŸ“¦ í•„ìš”í•œ íŒ¨í‚¤ì§€

```r
install.packages(c("sf", "rnaturalearth", "rnaturalearthdata", "tmap"))
```
:::

## 4.1 ê³µê°„ ë°ì´í„°ì˜ ê¸°ì´ˆ

### 4.1.1 Simple Features (sf)ë€?

**sf (Simple Features for R)**ëŠ” ê³µê°„ ë°ì´í„°ë¥¼ ë‹¤ë£¨ëŠ” í˜„ëŒ€ì ì¸ R íŒ¨í‚¤ì§€ì…ë‹ˆë‹¤.

**ì£¼ìš” íŠ¹ì§•:**
- tidyverseì™€ ì™„ë²½ í˜¸í™˜ (dplyr, ggplot2 ë“±)
- GDAL/GEOS ê¸°ë°˜ìœ¼ë¡œ ë¹ ë¥´ê³  ì•ˆì •ì 
- ë°ì´í„°í”„ë ˆì„ì²˜ëŸ¼ ë‹¤ë£° ìˆ˜ ìˆëŠ” ì§ê´€ì  êµ¬ì¡°

**ì¢Œí‘œê³„ (CRS, Coordinate Reference System):**
- **WGS84 (EPSG:4326)**: ê²½ë„/ìœ„ë„ ì¢Œí‘œê³„ (GPS í‘œì¤€)
- **Korea 2000 (EPSG:5179)**: í•œêµ­ í‰ë©´ì§ê°ì¢Œí‘œê³„
- **Web Mercator (EPSG:3857)**: ì›¹ ì§€ë„ìš©

### 4.1.2 í•œêµ­ ì§€ë„ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°

```{r}
#| eval: true
#| echo: true
#| warning: false

library(tidyverse)
library(sf)
library(rnaturalearth)

# ì„¸ê³„ ì§€ë„ì—ì„œ í•œêµ­ ì¶”ì¶œ
korea <- ne_countries(scale = "medium", country = "South Korea", returnclass = "sf")

# êµ¬ì¡° í™•ì¸
glimpse(korea)
```

```{r}
#| eval: true
#| echo: true
#| label: fig-korea-basic
#| fig-cap: "í•œêµ­ ê¸°ë³¸ ì§€ë„"

# ê¸°ë³¸ í”Œë¡¯
ggplot(data = korea) +
  geom_sf(fill = "lightblue", color = "black") +
  theme_minimal() +
  labs(title = "ëŒ€í•œë¯¼êµ­")
```

## 4.2 ì‹œë®¬ë ˆì´ì…˜ ë°ì´í„°ë¡œ ì½”ë¡œí”Œë ˆìŠ¤ ë§µ ì œì‘

ì‹¤ìŠµì„ ìœ„í•´ ì‹œë„ë³„ ê°€ìƒ ì§ˆë³‘ ë°ì´í„°ë¥¼ ë§Œë“¤ê² ìŠµë‹ˆë‹¤.

### 4.2.1 ì‹œë®¬ë ˆì´ì…˜ ë°ì´í„° ìƒì„±

```{r}
#| eval: true
#| echo: true

# í•œêµ­ 17ê°œ ì‹œë„ ë°ì´í„° ìƒì„±
set.seed(123)
regional_disease <- tibble(
  region = c("ì„œìš¸", "ë¶€ì‚°", "ëŒ€êµ¬", "ì¸ì²œ", "ê´‘ì£¼", "ëŒ€ì „", "ìš¸ì‚°", "ì„¸ì¢…",
             "ê²½ê¸°", "ê°•ì›", "ì¶©ë¶", "ì¶©ë‚¨", "ì „ë¶", "ì „ë‚¨", "ê²½ë¶", "ê²½ë‚¨", "ì œì£¼"),
  population = c(9700000, 3400000, 2400000, 3000000, 1500000, 1500000, 1100000, 360000,
                 13500000, 1500000, 1600000, 2100000, 1800000, 1800000, 2600000, 3300000, 670000),
  cases = c(980, 340, 245, 305, 155, 152, 112, 37,
            1360, 153, 163, 214, 183, 185, 265, 335, 68),
  deaths = c(98, 34, 25, 31, 16, 15, 11, 4,
             136, 15, 16, 21, 18, 19, 27, 34, 7)
) %>%
  mutate(
    incidence_rate = (cases / population) * 100000,  # ì¸êµ¬ 10ë§Œëª…ë‹¹
    case_fatality = (deaths / cases) * 100  # ì¹˜ëª…ë¥  (%)
  )

# ë°ì´í„° í™•ì¸
head(regional_disease)
```

### 4.2.2 ê°„ë‹¨í•œ ì  ì§€ë„ (Point Map)

```{r}
#| eval: true
#| echo: true
#| label: fig-point-map
#| fig-cap: "ì‹œë„ë³„ ë°œìƒë¥  (ì› í¬ê¸° ë¹„ë¡€)"

# ì‹œë„ë³„ ëŒ€ëµì ì¸ ì¢Œí‘œ (ì¤‘ì‹¬ì )
region_coords <- tibble(
  region = c("ì„œìš¸", "ë¶€ì‚°", "ëŒ€êµ¬", "ì¸ì²œ", "ê´‘ì£¼", "ëŒ€ì „", "ìš¸ì‚°", "ì„¸ì¢…",
             "ê²½ê¸°", "ê°•ì›", "ì¶©ë¶", "ì¶©ë‚¨", "ì „ë¶", "ì „ë‚¨", "ê²½ë¶", "ê²½ë‚¨", "ì œì£¼"),
  lon = c(126.98, 129.08, 128.60, 126.71, 126.85, 127.38, 129.31, 127.29,
          127.18, 128.21, 127.70, 126.80, 127.15, 126.99, 128.89, 128.25, 126.53),
  lat = c(37.57, 35.18, 35.87, 37.46, 35.16, 36.35, 35.54, 36.48,
          37.41, 37.82, 36.64, 36.52, 35.72, 34.86, 36.25, 35.46, 33.49)
)

# ë°ì´í„° ê²°í•©
map_data <- regional_disease %>%
  left_join(region_coords, by = "region")

# ì  ì§€ë„
ggplot() +
  geom_sf(data = korea, fill = "grey95", color = "black") +
  geom_point(data = map_data,
             aes(x = lon, y = lat, size = incidence_rate, color = incidence_rate),
             alpha = 0.7) +
  scale_size_continuous(name = "ë°œìƒë¥ \n(ì¸êµ¬ 10ë§Œëª…ë‹¹)", range = c(3, 15)) +
  scale_color_viridis_c(name = "ë°œìƒë¥ \n(ì¸êµ¬ 10ë§Œëª…ë‹¹)", option = "plasma") +
  theme_minimal() +
  labs(title = "ì‹œë„ë³„ ì§ˆë³‘ ë°œìƒë¥  ë¶„í¬",
       subtitle = "ì›ì˜ í¬ê¸°ì™€ ìƒ‰ìƒì´ ë°œìƒë¥ ì— ë¹„ë¡€") +
  theme(
    legend.position = "right",
    plot.title = element_text(face = "bold", size = 14)
  )
```

### 4.2.3 ë§‰ëŒ€ ê·¸ë˜í”„ë¡œ ì§€ì—­ ë¹„êµ

```{r}
#| eval: true
#| echo: true
#| label: fig-regional-bar
#| fig-cap: "ì‹œë„ë³„ ë°œìƒë¥  ìˆœìœ„"

# ë°œìƒë¥  ìˆœìœ„
regional_disease %>%
  arrange(desc(incidence_rate)) %>%
  mutate(region = fct_reorder(region, incidence_rate)) %>%
  ggplot(aes(x = region, y = incidence_rate, fill = incidence_rate)) +
  geom_col(alpha = 0.8) +
  geom_text(aes(label = round(incidence_rate, 1)),
            hjust = -0.1, size = 3) +
  scale_fill_viridis_c(option = "plasma") +
  coord_flip() +
  labs(
    title = "ì‹œë„ë³„ ì§ˆë³‘ ë°œìƒë¥  (ì¸êµ¬ 10ë§Œëª…ë‹¹)",
    x = NULL,
    y = "ë°œìƒë¥  (per 100,000)",
    fill = "ë°œìƒë¥ "
  ) +
  theme_minimal() +
  theme(
    legend.position = "none",
    plot.title = element_text(face = "bold", size = 14)
  )
```

## 4.3 ì¹˜ëª…ë¥  (Case Fatality Rate) ë¶„ì„

```{r}
#| eval: true
#| echo: true
#| label: fig-cfr-comparison
#| fig-cap: "ë°œìƒë¥  vs ì¹˜ëª…ë¥  ì‚°ì ë„"

ggplot(regional_disease, aes(x = incidence_rate, y = case_fatality)) +
  geom_point(aes(size = population, color = region), alpha = 0.7) +
  geom_smooth(method = "lm", se = TRUE, color = "red", linetype = "dashed") +
  geom_text(aes(label = region), vjust = -0.8, size = 3, check_overlap = TRUE) +
  scale_size_continuous(name = "ì¸êµ¬", labels = scales::comma) +
  labs(
    title = "ë°œìƒë¥ ê³¼ ì¹˜ëª…ë¥ ì˜ ê´€ê³„",
    x = "ë°œìƒë¥  (ì¸êµ¬ 10ë§Œëª…ë‹¹)",
    y = "ì¹˜ëª…ë¥  (%)",
    color = "ì‹œë„"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(face = "bold", size = 14),
    legend.position = "bottom"
  )
```

## 4.4 ì¸êµ¬ í‘œì¤€í™”: ê³µì •í•œ ë¹„êµë¥¼ ìœ„í•´

**ë¬¸ì œ**: ì¸êµ¬ê°€ ë§ì€ ì§€ì—­ì´ ë°œìƒ ê±´ìˆ˜ê°€ ë§ì„ ìˆ˜ ìˆìŒ

**í•´ê²°**: **í‘œì¤€í™” ë°œìƒë¹„ (SIR, Standardized Incidence Ratio)** ì‚¬ìš©

```{r}
#| eval: true
#| echo: true

# ì „êµ­ í‰ê·  ë°œìƒë¥ 
national_rate <- sum(regional_disease$cases) / sum(regional_disease$population) * 100000

# SIR ê³„ì‚°
regional_disease_sir <- regional_disease %>%
  mutate(
    expected_cases = (population / 100000) * national_rate,
    SIR = (cases / expected_cases) * 100,
    SIR_category = case_when(
      SIR < 80 ~ "ë§¤ìš° ë‚®ìŒ",
      SIR < 95 ~ "ë‚®ìŒ",
      SIR < 105 ~ "í‰ê· ",
      SIR < 120 ~ "ë†’ìŒ",
      TRUE ~ "ë§¤ìš° ë†’ìŒ"
    )
  )

# SIR ê²°ê³¼
regional_disease_sir %>%
  select(region, cases, expected_cases, SIR, SIR_category) %>%
  arrange(desc(SIR))
```

```{r}
#| eval: true
#| echo: true
#| label: fig-sir-map
#| fig-cap: "í‘œì¤€í™” ë°œìƒë¹„ (SIR) - ì „êµ­ í‰ê·  ëŒ€ë¹„"

# SIR ì  ì§€ë„
map_data_sir <- regional_disease_sir %>%
  left_join(region_coords, by = "region")

ggplot() +
  geom_sf(data = korea, fill = "grey95", color = "black") +
  geom_point(data = map_data_sir,
             aes(x = lon, y = lat, size = abs(SIR - 100), color = SIR),
             alpha = 0.7) +
  scale_size_continuous(name = "ì „êµ­ í‰ê· ê³¼ì˜\nì°¨ì´", range = c(3, 15)) +
  scale_color_gradient2(
    name = "SIR",
    low = "blue", mid = "white", high = "red",
    midpoint = 100,
    breaks = c(80, 90, 100, 110, 120)
  ) +
  theme_minimal() +
  labs(
    title = "í‘œì¤€í™” ë°œìƒë¹„ (SIR)",
    subtitle = "100 = ì „êµ­ í‰ê· , >100 = í‰ê· ë³´ë‹¤ ë†’ìŒ, <100 = í‰ê· ë³´ë‹¤ ë‚®ìŒ"
  ) +
  theme(
    legend.position = "right",
    plot.title = element_text(face = "bold", size = 14)
  )
```

## 4.5 ê³µê°„ ë°ì´í„° ë¶„ì„ ì›Œí¬í”Œë¡œìš°

### 4.5.1 ì‹¤ì „ ë¶„ì„ ë‹¨ê³„

**1ë‹¨ê³„: ë°ì´í„° ìˆ˜ì§‘**
- ì§ˆë³‘ ë°œìƒ ë°ì´í„° (ë³´ê±´ì†Œ, ì§ˆë³‘ê´€ë¦¬ì²­)
- ì¸êµ¬ ë°ì´í„° (í†µê³„ì²­)
- ê³µê°„ ê²½ê³„ íŒŒì¼ (Shapefile, GeoJSON)

**2ë‹¨ê³„: ë°ì´í„° ì „ì²˜ë¦¬**
```r
# í‘œì¤€í™”
- ì¸êµ¬ 10ë§Œëª…ë‹¹ ë°œìƒë¥ 
- ì—°ë ¹ í‘œì¤€í™” (ì§ì ‘/ê°„ì ‘ í‘œì¤€í™”)
- SIR ê³„ì‚°
```

**3ë‹¨ê³„: ê³µê°„ ê²°í•©**
```r
# sf ê°ì²´ì™€ ë°ì´í„° ê²°í•©
combined_data <- left_join(spatial_data, disease_data, by = "region_id")
```

**4ë‹¨ê³„: ì‹œê°í™”**
- ì½”ë¡œí”Œë ˆìŠ¤ ë§µ: `geom_sf()` + `scale_fill_*`
- ì  ì§€ë„: `geom_point()` with coordinates
- ë³µí•© ë ˆì´ì–´: ì§€ë„ + ì  + ë¼ë²¨

**5ë‹¨ê³„: í•´ì„**
- ê³µê°„ í´ëŸ¬ìŠ¤í„° íƒì§€
- í•«ìŠ¤íŒŸ ë¶„ì„
- ì‹œê³„ì—´ ê³µê°„ ë³€í™”

## 4.6 ìœ ìš©í•œ íŒê³¼ íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### 4.6.1 ì¢Œí‘œê³„ ë³€í™˜

```{r}
#| eval: false
#| echo: true

# WGS84 â†’ UTM-K (EPSG:5179) ë³€í™˜
korea_utm <- st_transform(korea, crs = 5179)

# ì¢Œí‘œê³„ í™•ì¸
st_crs(korea_utm)
```

### 4.6.2 ê³µê°„ ë°ì´í„° ì†ŒìŠ¤

**ë¬´ë£Œ ê³µê°„ ë°ì´í„°:**
- **ëŒ€í•œë¯¼êµ­ í–‰ì •êµ¬ì—­**: [êµ­ê°€ê³µê°„ì •ë³´í¬í„¸](http://data.nsdi.go.kr)
- **ì„¸ê³„ ì§€ë„**: `rnaturalearth` íŒ¨í‚¤ì§€
- **OpenStreetMap**: `osmdata` íŒ¨í‚¤ì§€
- **í†µê³„ì²­**: [SGIS](https://sgis.kostat.go.kr)

### 4.6.3 ggplot2 vs tmap ì„ íƒ ê°€ì´ë“œ

| ê¸°ì¤€ | ggplot2 + geom_sf() | tmap |
|------|---------------------|------|
| **í•™ìŠµ ê³¡ì„ ** | tidyverse ì‚¬ìš©ìì—ê²Œ ì‰¬ì›€ | ì „ìš© ë¬¸ë²• í•„ìš” |
| **ì»¤ìŠ¤í„°ë§ˆì´ì§•** | ë§¤ìš° ìœ ì—° | í…œí”Œë¦¿ ê¸°ë°˜ |
| **ì¸í„°ë™í‹°ë¸Œ** | plotlyë¡œ ë³€í™˜ ê°€ëŠ¥ | ë‚´ì¥ ì§€ì› (`tmap_mode("view")`) |
| **ì¶œíŒ í’ˆì§ˆ** | ì™„ë²½ ì œì–´ | ë¹ ë¥¸ í”„ë¡œí† íƒ€ì… |
| **ê¶Œì¥ ìš©ë„** | ë…¼ë¬¸, ì„¸ë°€í•œ ì¡°ì • | íƒìƒ‰ì  ë¶„ì„, ëŒ€ì‹œë³´ë“œ |

## ìš”ì•½

âœ… **sf íŒ¨í‚¤ì§€**ë¡œ ê³µê°„ ë°ì´í„°ë¥¼ ë°ì´í„°í”„ë ˆì„ì²˜ëŸ¼ ë‹¤ë£¸
âœ… **ë°œìƒë¥  ê³„ì‚°**: ì¸êµ¬ 10ë§Œëª…ë‹¹ í‘œì¤€í™” í•„ìˆ˜
âœ… **SIR (í‘œì¤€í™” ë°œìƒë¹„)**: ê³µì •í•œ ì§€ì—­ ê°„ ë¹„êµ
âœ… **ì‹œê°í™” ì „ëµ**: ì  ì§€ë„ vs ì½”ë¡œí”Œë ˆìŠ¤ ë§µ
âœ… **ë°ì´í„° ì†ŒìŠ¤**: êµ­ê°€ê³µê°„ì •ë³´í¬í„¸, rnaturalearth

::: {.callout-tip}
## ğŸ“š ë” ë°°ìš°ê¸°

**ê³ ê¸‰ ê³µê°„ ë¶„ì„:**
- `spdep` íŒ¨í‚¤ì§€: ê³µê°„ ìê¸°ìƒê´€, Moran's I
- `spatstat` íŒ¨í‚¤ì§€: ì  íŒ¨í„´ ë¶„ì„
- `ggspatial` íŒ¨í‚¤ì§€: ë¶ìª½ í™”ì‚´í‘œ, ì¶•ì²™ ì¶”ê°€

**ì¸í„°ë™í‹°ë¸Œ ì§€ë„:**
- `leaflet` íŒ¨í‚¤ì§€: ì›¹ ì¸í„°ë™í‹°ë¸Œ ì§€ë„
- `mapview` íŒ¨í‚¤ì§€: ë¹ ë¥¸ íƒìƒ‰ìš© ì§€ë„
:::
